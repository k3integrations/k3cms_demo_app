<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for :title %></title>
    <%= stylesheet_link_tag :all, :recursive => true %>
    <%= javascript_include_tag :defaults, :k3 %>
    <%= csrf_meta_tag %>
  </head>
  <body>
    
    <% if user_signed_in? -%>
      <%# TODO: Should this part be moved out to k3_authentication or similar gem? %>
      <% add_to_ribbon do %>
        <li class="logged_in_as">
          Logged in as: <%= k3_user.email %>
        </li>
        <li>
          <%= link_to 'Sign out', destroy_user_session_path %>
        </li>
      <% end -%>
    <% else %>
      <ul>
      <li><%= link_to 'Sign up', new_user_registration_path %></li>
      <li><%= link_to 'Sign in', new_user_session_path %></li>
      </ul>
    <% end -%>

    <%= render_cell 'k3/ribbon', :show, :current_page => @page, :k3_ribbon_items => @k3_ribbon_items %>
    
    <% if flash[:notice] %>
      <p class="notice"><%= notice %></p>
    <% end %>
    <% if flash[:error] %>
      <p class="error"><%= flash[:error] %></p>
    <% end %>

    <%= yield %>

    <%= render_cell 'k3/inline_editor', :init_edit_mode %>
  </body>
</html>
